<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Be My Valentine?</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#ff5ea8;
      --bg2:#ff2d55;
      --bg3:#ffd6e7;
      --card:#ffffffee;
      --text:#2a0b19;
      --muted:#6b2b44;
      --yes:#19c37d;
      --shadow: 0 18px 60px rgba(0,0,0,.18);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Nunito, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      min-height:100svh;
      background:
        radial-gradient(1200px 800px at 20% 10%, var(--bg3), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* floating hearts background */
    .hearts{position:fixed; inset:0; pointer-events:none; overflow:hidden;}
    .heart{
      position:absolute;
      width:18px; height:18px;
      background: rgba(255,255,255,.65);
      transform: rotate(45deg);
      animation: floatUp linear infinite;
      border-radius:4px;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.12));
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width:18px; height:18px;
      background: inherit;
      border-radius:50%;
    }
    .heart:before{left:-9px; top:0}
    .heart:after{left:0; top:-9px}
    @keyframes floatUp{
      from{ transform: translateY(110vh) rotate(45deg); opacity:0; }
      10%{opacity:.9}
      to{ transform: translateY(-20vh) rotate(45deg); opacity:0; }
    }

    .wrap{max-width: 980px; margin: 0 auto; padding: 28px 16px 60px;}
    .topbar{
      display:flex; align-items:center; justify-content:center;
      margin: 8px 0 18px;
      color: rgba(255,255,255,.95);
      text-shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    .topbar .logo{font-family: Pacifico, cursive; font-size: 28px;}

    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,.35);
      overflow:hidden;
    }

    .pane{ padding: 18px; }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 16px;
    }
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }

    h1{ margin:0 0 10px; font-size: 28px; line-height: 1.1; }
    h1 span{ font-family: Pacifico, cursive; font-weight:400; }

    .hint{color:var(--muted); margin: 0 0 14px;}
    .field{ margin: 12px 0; }
    label{ display:block; font-weight:800; margin: 0 0 6px; }

    input[type="text"], textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.12);
      padding: 12px 12px;
      font-size: 15px;
      outline:none;
      background: rgba(255,255,255,.8);
    }
    textarea{ min-height: 120px; resize: vertical; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-start; }

    .btn{
      border:0;
      border-radius: 16px;
      padding: 12px 14px;
      font-weight: 800;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
      box-shadow: 0 10px 25px rgba(0,0,0,.12);
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.green{ background: var(--yes); color:white; }
    .btn.copy{ background: #111; color:#fff; }
    .btn.pink{ background: #ffeff7; }

    .note{
      margin-top: 10px;
      background: rgba(255, 231, 244, .7);
      border: 1px dashed rgba(0,0,0,.15);
      padding: 10px 12px;
      border-radius: 14px;
      color: #4b1730;
      font-size: 13px;
    }

    /* Preview / Valentine card */
    .val-wrap{ display:flex; align-items:center; justify-content:center; padding: 22px; min-height: 560px; }
    .val-card{
      width: min(640px, 100%);
      border-radius: 26px;
      padding: 22px 18px 18px;
      background: rgba(255,255,255,.9);
      border: 1px solid rgba(255,255,255,.45);
      box-shadow: var(--shadow);
      position:relative;
      text-align:center;
    }

    .headline{ font-family: Pacifico, cursive; font-size: 40px; margin: 6px 0 8px; color: #d1004b; }
    @media (max-width: 420px){ .headline{font-size: 34px} }

    .submsg{ color:#5a1733; font-size: 16px; margin: 12px 0 18px; }

    /* Big, uncropped photo */
    .photo{
      width: 280px;
      height: 280px;
      margin: 16px auto 18px;
      position:relative;
      border-radius: 26px;
      overflow:hidden;
      box-shadow: 0 16px 35px rgba(0,0,0,.16);
      border: 6px solid rgba(255,255,255,.85);
      background: #fff;
    }
    .photo img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    .actions{
      display:flex;
      gap: 12px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 14px;
      min-height: 56px;
      position:relative;
    }
    .yesBtn{ background: var(--yes); color:#fff; }
    .noBtn{ background: #ffeff2; color: #b9002f; position:relative; }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.2);
      color: rgba(255,255,255,.95);
      border: 1px solid rgba(255,255,255,.25);
      font-size: 12px;
      margin: 10px auto 0;
    }

    /* Celebration + bonus overlays */
    .overlay{
      display:none;
      position:absolute;
      inset:0;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: radial-gradient(900px 650px at 20% 10%, rgba(255,255,255,.35), transparent 60%),
                  linear-gradient(135deg, rgba(255,94,168,.92), rgba(255,45,85,.92));
      border-radius: 26px;
      z-index: 5;
    }
    .overlay.show{ display:flex; }
    .overlay .msg{
      background: rgba(255,255,255,.94);
      border-radius: 22px;
      padding: 18px 16px;
      width: min(520px, 96%);
      box-shadow: var(--shadow);
      text-align:center;
    }
    .overlay h2{
      font-family: Pacifico, cursive;
      margin: 0 0 6px;
      color: #d1004b;
      font-size: 34px;
    }
    .overlay p{ margin:0; color:#5a1733; font-size: 16px; }

    /* Heart-shaped photo in bonus */
    .bonusPhoto{ width: 230px; height: 230px; margin: 14px auto 0; position:relative; }
    .bonusHeart{
      width:100%; height:100%; position:absolute; inset:0;
      background:#fff;
      transform: rotate(45deg);
      border-radius: 24px;
      box-shadow: 0 16px 35px rgba(0,0,0,.18);
      overflow:hidden;
    }
    .bonusHeart:before,.bonusHeart:after{
      content:"";
      position:absolute;
      width:100%; height:100%;
      background: inherit;
      border-radius:50%;
    }
    .bonusHeart:before{ left:-50%; top:0 }
    .bonusHeart:after{ left:0; top:-50% }
    .bonusHeart img{
      position:absolute;
      inset:-18%;
      width:136%; height:136%;
      object-fit: cover;
      transform: rotate(-45deg);
    }

    canvas#confetti{ position:absolute; inset:0; width:100%; height:100%; border-radius: 26px; pointer-events:none; }

    .small{font-size:12px; color:rgba(255,255,255,.9); margin-top:12px; text-align:center}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>

<body>
  <div class="hearts" id="hearts"></div>

  <div class="wrap">
    <div class="topbar"><div class="logo">Valentine Ask Page</div></div>

    <!-- Builder -->
    <div class="card" id="builderCard">
      <div class="pane">
        <h1>Customize your <span>Valentine</span> üíù</h1>
        <p class="hint">Paste a main photo link + a bonus photo link, write your message, preview it, then generate a shareable link.</p>

        <div class="grid">
          <div class="pane" style="padding:0">
            <div class="field">
              <label for="photoUrl">Main Image URL</label>
              <input id="photoUrl" type="text" placeholder="Paste your RAW GitHub image link here..." />
              <div class="note">
                Use a direct link that opens the image by itself (raw.githubusercontent.com). Google Drive often won‚Äôt embed.
              </div>
            </div>

            <div class="field">
              <label for="bonusUrl">Bonus Image URL (final screen)</label>
              <input id="bonusUrl" type="text" placeholder="Paste your second photo link here..." />
            </div>

            <div class="field">
              <label for="message">Your message</label>
              <textarea id="message" placeholder="Write something sweet...">I love you so much. You make my life brighter every day. üíï</textarea>
            </div>

            <div class="row">
              <button class="btn green" id="previewBtn" type="button">Preview</button>
              <button class="btn copy" id="copyLinkBtn" type="button">Copy shareable link</button>
              <button class="btn pink" id="openLinkBtn" type="button">Open valentine page</button>
            </div>

            <div class="note">
              This site uses the URL to store your message + photo links. Click ‚ÄúCopy shareable link‚Äù and send that to your girlfriend.
            </div>
          </div>

          <div class="pane" style="padding:0">
            <div class="val-wrap">
              <div class="val-card">
                <div class="headline">Will you be my Valentine?</div>

                <div class="photo" id="photoBox" style="display:none">
                  <img id="photoImg" alt="photo" />
                </div>

                <p class="submsg" id="msgOut"></p>

                <div class="actions">
                  <button class="btn yesBtn" disabled>Yes üíñ</button>
                  <button class="btn noBtn" disabled>No üôà</button>
                </div>

                <div class="pill">Preview only ‚Äî buttons work on the shared page</div>
              </div>
            </div>
          </div>
        </div>

        <div class="small">Your site: <span class="mono">https://wiiltonn.github.io/valentine-page/</span></div>
      </div>
    </div>

    <!-- Valentine page -->
    <div class="card" id="valentineCard" style="display:none">
      <div class="val-wrap">
        <div class="val-card" id="liveCard">
          <canvas id="confetti"></canvas>

          <div class="headline">Will you be my Valentine?</div>

          <div class="photo" id="livePhotoBox" style="display:none">
            <img id="livePhoto" alt="photo" />
          </div>

          <p class="submsg" id="liveMsg"></p>

          <div class="actions" id="btnArea">
            <button class="btn yesBtn" id="yesBtn" type="button">Yes üíñ</button>
            <button class="btn noBtn" id="noBtn" type="button">No üôà</button>
          </div>

          <!-- Celebration -->
          <div class="overlay" id="celebrate">
            <div class="msg">
              <h2>I knew you‚Äôd say yes! üíï</h2>
              <p>Happy Valentine‚Äôs Day, my love. Now come here ü•∞</p>
              <div style="margin-top:12px">
                <button class="btn pink" id="bonusBtn" type="button">One more thing‚Ä¶ üíù</button>
              </div>
            </div>
          </div>

          <!-- Bonus screen -->
          <div class="overlay" id="bonus">
            <div class="msg">
              <h2>Bonus level unlocked ‚ú®</h2>
              <p>This is my favourite photo of us. I love you üíó</p>

              <div class="bonusPhoto" id="bonusPhotoBox" style="display:none">
                <div class="bonusHeart"><img id="bonusPhoto" alt="photo" /></div>
              </div>

              <div class="row" style="justify-content:center; margin-top:14px">
                <button class="btn green" id="bonusClose" type="button">Ok come cuddle üíñ</button>
              </div>
            </div>
          </div>

        </div>
      </div>
      <div class="small" style="margin-top:-8px">Tip: the ‚ÄúNo‚Äù button is shy üò≠</div>
    </div>
  </div>

  <script>
    // ===== Helpers
    const qs = (s) => document.querySelector(s);
    const enc = (s) => encodeURIComponent(s || "");
    const dec = (s) => decodeURIComponent(s || "");

    function makeHearts(){
      const container = qs('#hearts');
      const count = 26;
      for(let i=0;i<count;i++){
        const h = document.createElement('div');
        h.className='heart';
        const left = Math.random()*100;
        const size = 12 + Math.random()*18;
        const dur = 8 + Math.random()*10;
        const delay = Math.random()*6;
        h.style.left = left + 'vw';
        h.style.width = size + 'px';
        h.style.height = size + 'px';
        h.style.animationDuration = dur + 's';
        h.style.animationDelay = delay + 's';
        h.style.opacity = (0.35 + Math.random()*0.5).toFixed(2);
        container.appendChild(h);
      }
    }

    function setPreview(photoSrc, msg){
      qs('#msgOut').textContent = msg || '';
      const photoBox = qs('#photoBox');
      const img = qs('#photoImg');
      if(photoSrc){
        photoBox.style.display='block';
        img.src = photoSrc;
      } else {
        photoBox.style.display='none';
        img.removeAttribute('src');
      }
    }

    function setLive(photoSrc, msg){
      qs('#liveMsg').textContent = msg || '';
      const liveBox = qs('#livePhotoBox');
      const liveImg = qs('#livePhoto');
      if(photoSrc){
        liveBox.style.display='block';
        liveImg.src = photoSrc;
      } else {
        liveBox.style.display='none';
        liveImg.removeAttribute('src');
      }
    }

    function buildShareLink({msg, imgUrl, bonusUrl}){
      const base = location.href.split('#')[0].split('?')[0];
      const params = new URLSearchParams();
      params.set('m', msg || '');
      if(imgUrl) params.set('img', imgUrl);
      if(bonusUrl) params.set('bonus', bonusUrl);
      return base + '?' + params.toString();
    }

    function parseIncoming(){
      const params = new URLSearchParams(location.search);
      const msg = params.get('m') ? dec(params.get('m')) : '';
      const imgUrl = params.get('img') ? dec(params.get('img')) : '';
      const bonusUrl = params.get('bonus') ? dec(params.get('bonus')) : '';
      return { msg, img: imgUrl, bonus: bonusUrl };
    }

    // ===== Confetti (simple)
    function startConfetti(canvas){
      const ctx = canvas.getContext('2d');
      const DPR = window.devicePixelRatio || 1;

      function resize(){
        const rect = canvas.getBoundingClientRect();
        canvas.width = Math.floor(rect.width * DPR);
        canvas.height = Math.floor(rect.height * DPR);
      }
      resize();
      window.addEventListener('resize', resize);

      const pieces = Array.from({length: 120}).map(()=>({
        x: Math.random()*canvas.width,
        y: -Math.random()*canvas.height,
        w: 6 + Math.random()*10,
        h: 8 + Math.random()*14,
        vx: (-1 + Math.random()*2) * 1.6,
        vy: 2.2 + Math.random()*3.0,
        rot: Math.random()*Math.PI,
        vr: (-1 + Math.random()*2) * 0.12,
        a: 0.7 + Math.random()*0.3
      }));

      let stopAt = performance.now() + 4500;

      function draw(){
        const now = performance.now();
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for(const p of pieces){
          p.x += p.vx * DPR;
          p.y += p.vy * DPR;
          p.rot += p.vr;

          if(p.y > canvas.height + 40) p.y = -40;
          if(p.x < -40) p.x = canvas.width + 40;
          if(p.x > canvas.width + 40) p.x = -40;

          ctx.save();
          ctx.globalAlpha = p.a;
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot);
          ctx.fillStyle = 'rgba(255,255,255,.85)';
          ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
          ctx.restore();
        }
        if(now < stopAt) requestAnimationFrame(draw);
        else ctx.clearRect(0,0,canvas.width,canvas.height);
      }
      requestAnimationFrame(draw);
    }

    // ===== No button evasion
    function attachNoEvasion(noBtn, area){
      const noLines = ['No üôà','Nope üò≠','Try again üòú','Nice try ü§≠','Hehe nope üíÖ','Almost üòÖ','Not today üòè'];
      const move = () => {
        const rect = area.getBoundingClientRect();
        const b = noBtn.getBoundingClientRect();
        const pad = 8;
        const maxX = rect.width - b.width - pad;
        const maxY = rect.height - b.height - pad;
        const x = pad + Math.random() * Math.max(0, maxX - pad);
        const y = pad + Math.random() * Math.max(0, maxY - pad);
        noBtn.style.position = 'absolute';
        noBtn.style.left = x + 'px';
        noBtn.style.top = y + 'px';
        noBtn.textContent = noLines[Math.floor(Math.random()*noLines.length)];
      };

      noBtn.addEventListener('mouseenter', move);
      noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); move(); }, {passive:false});
      area.addEventListener('mousemove', (e) => {
        const r = noBtn.getBoundingClientRect();
        const dx = Math.abs(e.clientX - (r.left + r.width/2));
        const dy = Math.abs(e.clientY - (r.top + r.height/2));
        if(dx < 90 && dy < 70) move();
      });

      requestAnimationFrame(move);
    }

    // ===== Init
    makeHearts();

    const incoming = parseIncoming();
    const hasValentine = (incoming.msg || incoming.img || incoming.bonus);

    const builderCard = qs('#builderCard');
    const valentineCard = qs('#valentineCard');

    // Builder elements
    const photoUrlInput = qs('#photoUrl');
    const bonusUrlInput = qs('#bonusUrl');
    const msgInput = qs('#message');
    const previewBtn = qs('#previewBtn');
    const copyLinkBtn = qs('#copyLinkBtn');
    const openLinkBtn = qs('#openLinkBtn');

    function refreshPreview(){
      const msg = (msgInput.value || '').trim();
      const imgUrl = (photoUrlInput.value || '').trim();
      setPreview(imgUrl, msg);
    }

    if(!hasValentine){
      builderCard.style.display='block';
      valentineCard.style.display='none';
      refreshPreview();

      photoUrlInput.addEventListener('input', refreshPreview);
      msgInput.addEventListener('input', refreshPreview);
      previewBtn.addEventListener('click', refreshPreview);

      copyLinkBtn.addEventListener('click', async () => {
        const msg = (msgInput.value || '').trim();
        const imgUrl = (photoUrlInput.value || '').trim();
        const bonusUrl = (bonusUrlInput.value || '').trim();
        const link = buildShareLink({msg, imgUrl, bonusUrl});
        try{
          await navigator.clipboard.writeText(link);
          copyLinkBtn.textContent = 'Copied ‚úÖ';
          setTimeout(()=> copyLinkBtn.textContent = 'Copy shareable link', 1400);
        }catch(e){
          prompt('Copy this link:', link);
        }
      });

      openLinkBtn.addEventListener('click', () => {
        const msg = (msgInput.value || '').trim();
        const imgUrl = (photoUrlInput.value || '').trim();
        const bonusUrl = (bonusUrlInput.value || '').trim();
        window.location.href = buildShareLink({msg, imgUrl, bonusUrl});
      });
    } else {
      // Live Valentine page
      builderCard.style.display='none';
      valentineCard.style.display='block';
      setLive(incoming.img, incoming.msg);

      const yesBtn = qs('#yesBtn');
      const noBtn = qs('#noBtn');
      const celebrate = qs('#celebrate');
      const bonus = qs('#bonus');
      const bonusBtn = qs('#bonusBtn');
      const bonusClose = qs('#bonusClose');
      const confetti = qs('#confetti');
      const btnArea = qs('#btnArea');

      // Bonus photo uses BONUS link if provided, otherwise fall back to main image
      const bonusPhotoBox = qs('#bonusPhotoBox');
      const bonusPhoto = qs('#bonusPhoto');
      const bonusSrc = incoming.bonus || incoming.img;
      if(bonusSrc){
        bonusPhotoBox.style.display='block';
        bonusPhoto.src = bonusSrc;
      }

      attachNoEvasion(noBtn, btnArea);

      yesBtn.addEventListener('click', () => {
        celebrate.classList.add('show');
        startConfetti(confetti);
      });

      bonusBtn.addEventListener('click', () => {
        celebrate.classList.remove('show');
        bonus.classList.add('show');
        startConfetti(confetti);
      });

      bonusClose.addEventListener('click', () => {
        bonus.classList.remove('show');
      });

      // Tap outside msg to close celebrate
      celebrate.addEventListener('click', (e) => {
        if(e.target && e.target.closest('.msg')) return;
        celebrate.classList.remove('show');
      });
    }
  </script>
</body>
</html>
